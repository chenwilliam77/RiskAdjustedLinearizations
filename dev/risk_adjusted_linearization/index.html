<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Risk-Adjusted Linearizations · RiskAdjustedLinearizations.jl</title><link rel="canonical" href="https://juliadocs.github.io/Documenter.jl/stable/risk_adjusted_linearization/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">RiskAdjustedLinearizations.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Risk-Adjusted Linearizations</a><ul class="internal"><li><a class="tocitem" href="#Theory-1"><span>Theory</span></a></li><li><a class="tocitem" href="#Implementation:-RiskAdjustedLinearization-1"><span>Implementation: <code>RiskAdjustedLinearization</code></span></a></li><li><a class="tocitem" href="#Helper-Types-1"><span>Helper Types</span></a></li></ul></li><li><a class="tocitem" href="../numerical_algorithms/">Numerical Algorithms</a></li><li><a class="tocitem" href="../example/">Example</a></li><li><a class="tocitem" href="../caching/">Caching</a></li><li><a class="tocitem" href="../diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../tips/">Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Risk-Adjusted Linearizations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Risk-Adjusted Linearizations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/chenwilliam77/RiskAdjustedLinearizations.jl/blob/master/docs/src/risk_adjusted_linearization.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="risk-adjusted-linearization-1"><a class="docs-heading-anchor" href="#risk-adjusted-linearization-1">Risk-Adjusted Linearizations</a><a class="docs-heading-anchor-permalink" href="#risk-adjusted-linearization-1" title="Permalink"></a></h1><h2 id="Theory-1"><a class="docs-heading-anchor" href="#Theory-1">Theory</a><a class="docs-heading-anchor-permalink" href="#Theory-1" title="Permalink"></a></h2><h3 id="Nonlinear-Model-1"><a class="docs-heading-anchor" href="#Nonlinear-Model-1">Nonlinear Model</a><a class="docs-heading-anchor-permalink" href="#Nonlinear-Model-1" title="Permalink"></a></h3><p>Most dynamic economic models can be formulated as the system of nonlinear equations</p><div>\[\begin{aligned}
    z_{t + 1} &amp; = \mu(z_t, y_t) + \Lambda(z_t)(y_{t + 1} - \mathbb{E}_t y_{t + 1}) + \Sigma(z_t) \varepsilon_{t + 1},\\
    0 &amp; = \log\mathbb{E}_t[\exp(\xi(z_t, y_t) + \Gamma_5 z_{t + 1} + \Gamma_6 y_{t + 1})].
\end{aligned}\]</div><p>The vectors <span>$z_t\in \mathbb{R}^{n_z}$</span> and <span>$y_t \in \mathbb{R}^{n_y}$</span> are the state and jump variables, respectively. The first vector equation comprise the transition equations of the state variables. The second vector equation comprise the model&#39;s expectational equations, which are typically the first-order conditions for the jump variables from agents&#39; optimization problem. The exogenous shocks <span>$\varepsilon_t \in\mathbb{R}^{n_\varepsilon}$</span> form a martingale difference sequence and can therefore be non-Gaussian. Given some differentiable mapping <span>$\alpha:\mathbb{R}^{n_z}\rightarrow\mathbb{R}^{n_\varepsilon}$</span>, the random variable <span>$X_t = \alpha(z_t)^T \varepsilon_{t + 1}$</span> has the differentiable, conditional (on <span>$z_t$</span>) cumulant generating function</p><div>\[\begin{aligned}
ccgf[\alpha(z_t) \mid z_t] = \log\mathbb{E}_t[\exp(\alpha(z_t)^T \varepsilon_{t + 1})].
\end{aligned}\]</div><p>The functions</p><div>\[\begin{aligned}
\xi:\mathbb{R}^{2n_y + 2n_z}\rightarrow \mathbb{R}^{n_y},&amp; \quad \mu:\mathbb{R}^{n_y + n_z}\rightarrow \mathbb{R}^{n_z},\\
\Lambda:\mathbb{R}^{n_z} \rightarrow \mathbb{R}^{n_z \times n_y}, &amp; \quad \Sigma:\mathbb{R}^{n_z}\ \rightarrow \mathbb{R}^{n_z\times n_\varepsilon},
\end{aligned}\]</div><p>are differentiable. The first two functions characterize the effects of time <span>$t$</span> variables on the expectational and state transition equations. The function <span>$\Lambda$</span> characterizes heteroskedastic endogenous risk that depends on innovations in jump variables while the function <span>$\Sigma$</span> characterizes exogenous risk. Note that <span>$\Sigma$</span> is <em>not</em> the variance-covariance matrix of <span>$\varepsilon_t$</span>. The functions <span>$\Lambda$</span> and <span>$\Sigma$</span> can also depend on jump variables. Denote the jump-dependent versions as <span>$\tilde{\Lambda}:\mathbb{R}^{n_z\times n_y} \rightarrow \mathbb{R}^{n_z \times n_y}$</span> and <span>$\tilde{\Sigma}:\mathbb{R}^{n_z \times n_y}\ \rightarrow \mathbb{R}^{n_z\times n_\varepsilon}$</span>. If there exists a mapping <span>$y_t = y(z_t)$</span>, then we define <span>$\Lambda(z_t) = \tilde{\Lambda}(z_t, y(z_t))$</span> and <span>$\Sigma(z_t) = \tilde{\Sigma}(z_t, y(z_t))$</span>.</p><p>The expectational equations can be simplified as</p><div>\[\begin{aligned}
0 &amp; = \log\mathbb{E}_t[\exp(\xi(z_t, y_t) + \Gamma_5 z_{t + 1} + \Gamma_6 y_{t + 1})]\\
  &amp; = \log[\exp(\xi(z_t, y_t))\mathbb{E}_t[\exp(\Gamma_5 z_{t + 1} + \Gamma_6 y_{t + 1})]]\\
  &amp; = \xi(z_t, y_t) + \Gamma_5\mathbb{E}_t z_{t + 1} + \Gamma_6 \mathbb{E}_t y_{t + 1} + \log\mathbb{E}_t[\exp(\Gamma_5 z_{t + 1} + \Gamma_6 y_{t + 1})] - (\Gamma_5\mathbb{E}_t z_{t + 1} + \Gamma_6 \mathbb{E}_t y_{t + 1})\\
  &amp; = \xi(z_t, y_t) + \Gamma_5\mathbb{E}_t z_{t + 1} + \Gamma_6 \mathbb{E}_t y_{t + 1} + \mathcal{V}(\Gamma_5 z_{t + 1} + \Gamma_6 y_{t + 1}),
\end{aligned}\]</div><p>where the last term is defined to be</p><div>\[\begin{aligned}
\mathcal{V}(x_{t + 1}) = \log\mathbb{E}_t[\exp(x_{t + 1})] - \mathbb{E}_t x_{t + 1}.
\end{aligned}\]</div><p>As Lopez et al. (2018) describe it, this quantity &quot;is a relative entropy measure, i.e. a nonnegative measure of dispersion that generalizes variance.&quot;</p><h3 id="affine-theory-1"><a class="docs-heading-anchor" href="#affine-theory-1">Risk-Adjusted Linearizations by Affine Approximation</a><a class="docs-heading-anchor-permalink" href="#affine-theory-1" title="Permalink"></a></h3><p>Many economic models are typically solved by perturbation around the deterministic steady state. To break certainty equivalence so that asset pricing is meaningful, these perturbations need to be at least third order. However, even third-order perturbations can poorly approximate the true global solution. A key problem is that the economy may not spend much time near the deterministic steady state, so a perturbation around this point will be inaccurate.</p><p>Instead of perturbing the model&#39;s nonlinear equations around the deterministic steady state, we could perturb around the stochastic or &quot;risky&quot; steady state. This point is better for a perturbation because the economy will spend a large amount of time near the stochastic steady state. <a href="https://ideas.repec.org/p/bfr/banfra/702.html">Lopez et al. (2018)</a> show that an affine approximation of the model&#39;s nonlinear equation is equivalent to a linearization around the stochastic steady state. Further, they confirm that in practice this &quot;risk-adjusted&quot; linearization approximates global solutions of canonical economic models very well and outperforms perturbations around the deterministic steady state.</p><p>The affine approximation of an dynamic economic model is</p><div>\[\begin{aligned}
    \mathbb{E}[z_{t + 1}] &amp; = \mu(z, y) + \Gamma_1(z_t - z) + \Gamma_2(y_t - y),\\
    0                      &amp; = \xi(z, y) + \Gamma_3(z_t - z) + \Gamma_4(y_t - y) + \Gamma_5 \mathbb{E}_t z_{t + 1} + \Gamma_6 \mathbb{E}_t y_{t + 1} + \mathcal{V}(z) + J\mathcal{V}(z)(z_t  - z),
\end{aligned}\]</div><p>where <span>$\Gamma_1, \Gamma_2$</span> are the Jacobians of <span>$\mu$</span> with respect to <span>$z_t$</span> and <span>$y_t$</span>, respectively; <span>$\Gamma_3, \Gamma_4$</span> are the Jacobians of <span>$\xi$</span> with respect to <span>$z_t$</span> and <span>$y_t$</span>, respectively; <span>$\Gamma_5, \Gamma_6$</span> are constant matrices; <span>$\mathcal{V}(z)$</span> is the model&#39;s entropy; and <span>$J\mathcal{V}(z)$</span> is the Jacobian of the entropy;</p><p>and the state variables <span>$z_t$</span> and jump variables <span>$y_t$</span> follow</p><div>\[\begin{aligned}
    z_{t + 1} &amp; = z + \Gamma_1(z_t - z) + \Gamma_2(y_t - y) + (I_{n_z} - \Lambda(z_t) \Psi)^{-1}\Sigma(z_t)\varepsilon_{t + 1},\\
    y_t       &amp; = y + \Psi(z_t - z).
\end{aligned}\]</div><p>The unknowns <span>$(z, y, \Psi)$</span> solve the system of equations</p><div>\[\begin{aligned}
0 &amp; = \mu(z, y) - z,\\
0 &amp; = \xi(z, y) + \Gamma_5 z + \Gamma_6 y + \mathcal{V}(z),\\
0 &amp; = \Gamma_3 + \Gamma_4 \Psi + (\Gamma_5 + \Gamma_6 \Psi)(\Gamma_1 + \Gamma_2 \Psi) + J\mathcal{V}(z).
\end{aligned}\]</div><p>Under an affine approximation, the entropy term is a nonnegative function <span>$\mathcal{V}:\mathbb{R}^{n_z} \rightarrow \mathbb{R}_+^{n_y}$</span> defined such that</p><div>\[\begin{aligned}
\mathcal{V}(z_t) \equiv \mathcal{V}_t(\exp((\Gamma_5 + \Gamma_6 \Psi)z_{t + 1})) = \vec{ccgf}[(\Gamma_5 + \Gamma_6 \Psi)(I_{n_z} - \Lambda(z_t) \Psi)^{-1} \Sigma(z_t) \mid z_t]
\end{aligned}\]</div><p>where the notation <span>$\vec{ccgf}$</span> means that each component <span>$ccgf_i[\cdot \mid \cdot]$</span> is a conditional cumulant-generating function. Explicitly, define</p><div>\[\begin{aligned}
A(z_t) = (\Gamma_5 + \Gamma_6 \Psi)(I_{n_z} - \Lambda(z_t) \Psi)^{-1} \Sigma(z_t) = [A_1(z_t), \dots, A_{n_y}(z_t)]^T.
\end{aligned}\]</div><p>Each <span>$A_i(z_t)$</span> is a mapping from <span>$z_t$</span> to the <span>$i$</span>th row vector in <span>$A(z_t)$</span>. Then <span>$ccgf_i[\cdot \mid \cdot]$</span> is</p><div>\[\begin{aligned}
ccgf_i[A_i(z_t)\mid z_t] = \log\mathbb{E}_t[\exp(A_i(z_t) \varepsilon_{t + 1})].
\end{aligned}\]</div><p>Every <span>$ccgf_i[\cdot \mid \cdot]$</span> corresponds to an expectational equation and thus acts as a risk correction to each one. In the common case where the individual components of <span>$\varepsilon_{t + 1}$</span> are independent, <span>$ccgf_i$</span> simplifies to</p><div>\[\begin{aligned}
ccgf_i[A_i(z_t)\mid z_t] = \sum_{j = 1}^{n_\varepsilon}\log\mathbb{E}_t[\exp(A_{ij}(z_t) \varepsilon_{j, t + 1})],
\end{aligned}\]</div><p>i.e. it is the sum of the cumulant-generating functions for each shock <span>$\varepsilon_{j, t + 1}$</span>.</p><p>Refer to <a href="https://ideas.repec.org/p/bfr/banfra/702.html">Lopez et al. (2018) &quot;Risk-Adjusted Linearizations of Dynamic Equilibrium Models&quot;</a> for more details about the theory justifying this approximation approach. See <a href="../tips/#ccgf-tips-1">Deriving the conditional cumulant generating function</a> for some guidance on calculating the ccgf, which many users may not have seen before.</p><h2 id="Implementation:-RiskAdjustedLinearization-1"><a class="docs-heading-anchor" href="#Implementation:-RiskAdjustedLinearization-1">Implementation: <code>RiskAdjustedLinearization</code></a><a class="docs-heading-anchor-permalink" href="#Implementation:-RiskAdjustedLinearization-1" title="Permalink"></a></h2><p>We implement risk-adjusted linearizations of nonlinear dynamic economic models through the wrapper type <code>RiskAdjustedLinearization</code>. The user only needs to define the functions and matrices characterizing the equilibrium of the nonlinear model. Once these functions are defined, the user can create a <code>RiskAdjustedLinearization</code> object, which will automatically create the Jacobian functions needed to compute the affine approximation.</p><p>To ensure efficiency in speed and memory, this package takes advantage of a number of features that are easily accessible through Julia.</p><ol><li><p>The Jacobians are calculated using forward-mode automatic differentiation rather than symbolic differentiation.</p></li><li><p>The Jacobian functions are constructed to be in-place with pre-allocated caches.</p></li><li><p>Functions provided by the user will be converted into in-place functions with pre-allocated caches.</p></li><li><p>(Coming in the future) Calculation of Jacobians with automatic differentiation is accelerated by exploiting sparsity with SparseDiffTools.jl</p></li></ol><p>See the <a href="../example/#example-1">Example</a> for how to use the type. To compare this package&#39;s speed with the original MATLAB code, run the <a href="https://github.com/chenwilliam77/RiskAdjustedLinearizations.jl/tree/main/examples/matlab_timing_test/wac_disaster.jl">wac_disaster.jl</a> or <a href="https://github.com/chenwilliam77/RiskAdjustedLinearizations.jl/tree/main/examples/matlab_timing_test/rbc_cc.jl">rbc_cc.jl</a> scripts. These scripts assess how long it takes to calculate a risk-adjusted linearization using the two numerical algorithms implemented by this package and by the original authors. The relaxation algorithm is generally around 50x-100x faster while the homotopy algorithm 3x-4x times faster.</p><article class="docstring"><header><a class="docstring-binding" id="RiskAdjustedLinearizations.RiskAdjustedLinearization" href="#RiskAdjustedLinearizations.RiskAdjustedLinearization"><code>RiskAdjustedLinearizations.RiskAdjustedLinearization</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">RiskAdjustedLinearization(μ, Λ, Σ, ξ, Γ₅, Γ₆, ccgf, z, y, Ψ, Nε)
RiskAdjustedLinearization(nonlinear_system, linearized_system, z, y, Ψ, Nz, Ny, Nε)</code></pre><p>Creates a first-order perturbation around the stochastic steady state of a discrete-time dynamic economic model.</p><p>The first method is the main constructor most users will want, while the second method is the default constructor.</p><p><strong>Inputs for First Method</strong></p><ul><li><code>μ::Function</code>: expected state transition function</li><li><code>ξ::Function</code>: nonlinear terms of the expectational equations</li><li><code>ccgf::Function</code>: conditional cumulant generating function of the exogenous shocks</li><li><code>Λ::Function</code> or <code>Λ::AbstractMatrix</code>: function or matrix mapping endogenous risk into state transition equations</li><li><code>Σ::Function</code> or <code>Σ::AbstractMatrix</code>: function or matrix mapping exogenous risk into state transition equations</li><li><code>Γ₅::AbstractMatrix{&lt;: Number}</code>: coefficient matrix on one-period ahead expectation of state variables</li><li><code>Γ₆::AbstractMatrix{&lt;: Number}</code>: coefficient matrix on one-period ahead expectation of jump variables</li><li><code>z::AbstractVector{&lt;: Number}</code>: state variables in stochastic steady state</li><li><code>y::AbstractVector{&lt;: Number}</code>: jump variables in stochastic steady state</li><li><code>Ψ::AbstractMatrix{&lt;: Number}</code>: matrix linking deviations in states to deviations in jumps, i.e. <span>$y_t - y = \Psi(z_t - z)$</span>.</li><li><code>Nε::Int</code>: number of exogenous shocks</li></ul><p><strong>Inputs for Second Method</strong></p><ul><li><code>nonlinear_system::RALNonlinearSystem</code></li><li><code>linearized_system::RALLinearizedSystem</code></li><li><code>z::AbstractVector{&lt;: Number}</code>: state variables in stochastic steady state</li><li><code>y::AbstractVector{&lt;: Number}</code>: jump variables in stochastic steady state</li><li><code>Ψ::AbstractMatrix{&lt;: Number}</code>: matrix linking deviations in states to deviations in jumps, i.e. <span>$y_t - y = \Psi(z_t - z)$</span>.</li><li><code>Nz::Int</code>: number of state variables</li><li><code>Ny::Int</code>: number of jump variables</li><li><code>Nε::Int</code>: number of exogenous shocks</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/chenwilliam77/RiskAdjustedLinearizations.jl/blob/d46b962ac2dce9a2a304e8bad54c1f5f722b3c08/src/risk_adjusted_linearization.jl#L121-L152">source</a></section></article><h2 id="Helper-Types-1"><a class="docs-heading-anchor" href="#Helper-Types-1">Helper Types</a><a class="docs-heading-anchor-permalink" href="#Helper-Types-1" title="Permalink"></a></h2><p>To organize the functions comprisng a risk-adjusted linearization, we create two helper types, <code>RALNonlinearSystem</code> and <code>RALLinearizedSystem</code>. The first type holds the <span>$\mu$</span>, <span>$\Lambda$</span>, <span>$\Sigma$</span>, <span>$\xi$</span>, and <span>$\mathcal{V}$</span> functions while the second type holds the <span>$\mu_z$</span>, <span>$\mu_y$</span>, <span>$\xi_z$</span>, <span>$\xi_y$</span>, <span>$J\mathcal{V}$</span>, <span>$\Gamma_5$</span>, and <span>$\Gamma_6$</span> quantities. The <code>RALNonlinearSystem</code> type holds potentially nonlinear functions, and in particular <span>$\mu$</span>, <span>$\xi$</span>, and <span>$\mathcal{V}$</span>, which need to be linearized (e.g. by automatic differentiation). The <code>RALLinearizedSystem</code> holds both matrices that are only relevant once the model is linearized, such as <span>$\Gamma_1$</span> (calculated by <span>$\mu_z$</span>), as well as <span>$\Gamma_5$</span> and <span>$\Gamma_6$</span> since these latter two quantities are always constant matrices.</p><p>Aside from providing a way to organize the various functions comprising a risk-adjusted linearization, these helper types do not have much additional functionality. The <code>update!</code> functions for a <code>RiskAdjustedLinearization</code>, for example, are implemented underneath the hood by calling <code>update!</code> functions written for the <code>RALNonlinearSystem</code> and <code>RALLinearizedSystem</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../numerical_algorithms/">Numerical Algorithms »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 1 January 2021 11:56">Friday 1 January 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
