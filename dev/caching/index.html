<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Caching · RiskAdjustedLinearizations.jl</title><link rel="canonical" href="https://juliadocs.github.io/Documenter.jl/stable/caching/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">RiskAdjustedLinearizations.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../risk_adjusted_linearization/">Risk-Adjusted Linearizations</a></li><li><a class="tocitem" href="../sparse_arrays_jacs/">Sparse Arrays and Jacobians</a></li><li><a class="tocitem" href="../numerical_algorithms/">Numerical Algorithms</a></li><li><a class="tocitem" href="../example/">Example</a></li><li class="is-active"><a class="tocitem" href>Caching</a><ul class="internal"><li><a class="tocitem" href="#new-cache-types-1"><span><code>TwoDiffCache</code> and <code>ThreeDiffCache</code></span></a></li><li><a class="tocitem" href="#ralfwrappers-1"><span>Automated Caching via <code>RALF1</code>, <code>RALF2</code>, <code>RALF3</code>, and <code>RALF4</code> Wrappers</span></a></li></ul></li><li><a class="tocitem" href="../diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../tips/">Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Caching</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Caching</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/chenwilliam77/RiskAdjustedLinearizations.jl/blob/master/docs/src/caching.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="caching-1"><a class="docs-heading-anchor" href="#caching-1">Caching</a><a class="docs-heading-anchor-permalink" href="#caching-1" title="Permalink"></a></h1><p>If users create a <code>RiskAdjustedLinearization</code> with the constructor</p><pre><code class="language-none">RiskAdjustedLinearization(μ, Λ, Σ, ξ, Γ₅, Γ₆, ccgf, z, y, Ψ, Nε)</code></pre><p>where <code>μ, Λ, Σ, ξ, ccgf</code> are either in-place or out-of-place functions, then we use the wrapper types <code>RALF1</code> and <code>RALF2</code> to convert these functions to non-allocating ones. The implementation of these wrappers is similar to the implementation of <code>LinSolveFactorize</code> in <a href="https://diffeq.sciml.ai/stable/features/linear_nonlinear/#Implementing-Your-Own-LinSolve:-How-LinSolveFactorize-Was-Created">DifferentialEquations.jl</a>. See <a href="#ralfwrappers-1">Automated Caching via <code>RALF1</code> and <code>RALF2</code></a> for further details. Unlike <code>LinSolveFactorize</code>, however, we need to be able to automatically differentiate with <code>RALF1</code> and <code>RALF2</code> so the cache needs to be handled more carefully. To do this, we utilize and extend the <code>DiffCache</code> type implemented by <a href="https://github.com/SciML/DiffEqBase.jl">DiffEqBase.jl</a>.</p><h2 id="new-cache-types-1"><a class="docs-heading-anchor" href="#new-cache-types-1"><code>TwoDiffCache</code> and <code>ThreeDiffCache</code></a><a class="docs-heading-anchor-permalink" href="#new-cache-types-1" title="Permalink"></a></h2><p>The idea for <code>DiffCache</code> is that you need two caches, one for Dual numbers when applying automatic differentiation and one for the subtype of <code>Number</code> used for the actual array (e.g. Float64). For the <span>$\Lambda$</span> and <span>$\Sigma$</span> functions, this type works because they are functions of one input variables. The functions <span>$\mu_z$</span>, <span>$\mu_y$</span>, <span>$\xi_z$</span>, and <span>$\xi_y$</span> also can use <code>DiffCache</code> once it is extended to work for functions with two input variables (e.g. the chunk size should depend on the length of both input variables).</p><p>However, for the <span>$\mu$</span>, <span>$\xi$</span>, and <span>$\mathcal{V}$</span> functions, we actually need multiple caches for Dual numbers that differ in their chunk size. The reason is that not only do we need to be able to evaluate them with Dual numbers but we also need to apply automatic differentiation to calculate their Jacobians. Because all three of these functions take two input variables, the chunk size for the cache used to evaluate the functions themselves will be different from the cache used to calculate the Jacobians, which occur with respect to only one of the input variables.</p><p><em>Note that, by default, the cache is initialized with undefined values if arrays are dense and zeros if arrays are sparse.</em></p><h2 id="ralfwrappers-1"><a class="docs-heading-anchor" href="#ralfwrappers-1">Automated Caching via <code>RALF1</code>, <code>RALF2</code>, <code>RALF3</code>, and <code>RALF4</code> Wrappers</a><a class="docs-heading-anchor-permalink" href="#ralfwrappers-1" title="Permalink"></a></h2><p>The <code>RALF1</code> type applies to functions with 1 input variables (<span>$\Lambda$</span> and <span>$\Sigma$</span>), <code>RALF2</code> to functions with 2 input variables (e.g. <span>$\mu$</span>, <span>$\mu_z$</span>), and so on. The way these wrappers work is that they take a user-defined function <code>f</code> and convert it to a new in-place function whose first input argument is a cache, which is a <code>DiffCache</code>, <code>TwoDiffCache</code>, or a <code>ThreeDiffCache</code>. The <code>RALF1</code>, <code>RALF2</code>, <code>RALF3</code>, and <code>RALF4</code> types are callable in the same way <code>LinSolveFactorize</code> is.</p><p>For <code>RALF2</code>, the syntax <code>(x::RALF2)(x1, x2)</code> on its own would not work, however, because (1) it is not clear which input should be used to infer whether or not to use a Dual cache and (2) there are potentially multiple Dual caches. To get around this problem, we add an optional third argument named <code>select</code>, which is a <code>Tuple{Int, Int}</code>. The first element specifies which input argument to use for infering whether a Dual cache is needed, and the second element specifies which cache to use. By default, <code>select = (1, 1)</code>. This approach is the same for <code>RALF3</code> and <code>RALF4</code>. The types <code>RALF3</code> and <code>RALF4</code> are only relevant if <span>$\Lambda$</span> and <span>$\Sigma$</span> depend on jump variables.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example/">« Example</a><a class="docs-footer-nextpage" href="../diagnostics/">Diagnostics »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 12 January 2021 12:52">Tuesday 12 January 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
